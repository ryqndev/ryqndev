import{r as d,aA as x}from"./index-Pc-9NhTT.js";const g=c=>(b,a,n)=>{const v=n.subscribe;return n.subscribe=(l,S,r)=>{let s=l;if(S){const k=(r==null?void 0:r.equalityFn)||Object.is;let u=l(n.getState());s=f=>{const e=l(f);if(!k(u,e)){const o=u;S(u=e,o)}},r!=null&&r.fireImmediately&&S(u,u)}return v(s)},c(b,a,n)},m=d.createContext(null);function j({map:c,children:b,onChange:a,domElement:n}){const v=c.map(r=>r.name+r.keys).join("-"),y=d.useMemo(()=>x(g(()=>c.reduce((r,s)=>({...r,[s.name]:!1}),{}))),[v]),l=d.useMemo(()=>[y.subscribe,y.getState,y],[v]),S=y.setState;return d.useEffect(()=>{const s=c.map(({name:e,keys:o,up:t})=>({keys:o,up:t,fn:i=>{S({[e]:i}),a&&a(e,i,l[1]())}})).reduce((e,{keys:o,fn:t,up:i=!0})=>(o.forEach(p=>e[p]={fn:t,pressed:!1,up:i}),e),{}),k=({key:e,code:o})=>{const t=s[e]||s[o];if(!t)return;const{fn:i,pressed:p,up:E}=t;t.pressed=!0,(E||!p)&&i(!0)},u=({key:e,code:o})=>{const t=s[e]||s[o];if(!t)return;const{fn:i,up:p}=t;t.pressed=!1,p&&i(!1)},f=n||window;return f.addEventListener("keydown",k,{passive:!0}),f.addEventListener("keyup",u,{passive:!0}),()=>{f.removeEventListener("keydown",k),f.removeEventListener("keyup",u)}},[n,v]),d.createElement(m.Provider,{value:l,children:b})}function C(c){const[b,a,n]=d.useContext(m);return c?n(c):[b,a]}export{j as K,C as u};
